<link rel="stylesheet" href="css/stylePersonalArea.css">
<% layout('layout/page') -%>
<% block('title') -%>
<!-- БЛОК с частями об аккаунте НАЧАЛО-->

    <h2 align="center"><strong>Личный кабинет</strong></h2>
    <br>

  <div class="container">
    <div class="row">
      <div class="card-row clearfix">
        <div class="col-md-4">
          <div class="card">
            <div class="description">
              <h4>Добро пожаловать, <%=user.get('username')%></h4>
              <% if (user.username == "admin" || user.username =="admin2") { %>

                <% switch (user.myAvatar) {
                case "1": %>
                  <p><img src="imagesPersonalArea/1_adminPhotoProfile.png" alt="" class="round"></p>
                   <% break; %><%
                  case "2": %>
                  <p><img src="imagesPersonalArea/2_adminPhotoProfile.png" alt="" class="round"></p>
                     <% break; %> <%
                  case "3": %>
                  <p><img src="imagesPersonalArea/3_adminPhotoProfile.png" alt="" class="round"></p>
                       <% break; %>
                  <% } %>


              <% } else if (user.gender == "Мужской") { %>

              <p><img src="imagesPersonalArea/standartPhotoProfileMan.png" alt="" class="round"></p>

              <% } else if (user.gender == "Женский") { %>

              <p><img src="imagesPersonalArea/standartPhotoProfileWomen.png" alt="" class="round"></p>

              <% } else { %>

                <p><img src="imagesPersonalArea/standartPhotoProfile.png" alt="" class="round"></p>
                <!--<p><img src="<%=user.get('myAvatar')%>" alt="" class="round">-->

               <% } %>
            </div>

            <form class="form-cabinet" name="cabinet_form">
            <h5>Текущий аватар: <%=user.get('myAvatar')%>
            <h5>Готовый аватар:
            <select name="myAvatar" type="text" class="form-control-personalArea" id="myAvatar">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            </select>
            </h5>

            <button type="button" class="btn btn-primary" id="editAvatar">Загрузить аватар</button>

            <!-- Администраторская панель начало-->
            <br><br><br>
              <% if (user.username == "admin" || user.username =="admin2") { %>
                <li><a href="/personalArea" onclick="$('body').append('<form id=\'submitme\' method=\'GET\' action=\'/users\'></form>');$('#submitme').submit();return false;">Список пользователей в JSON-формате</a></li>
                <br><br><br>
              <li><a href="/personalArea" onclick="$('body').append('<form id=\'submitme\' method=\'GET\' action=\'/dropDatabase\'></form>');$('#submitme').submit();return false;">ОЧИСТИТЬ БАЗУ ДАННЫХ</a></li>
              <% }  %>
            <!-- Администраторская панель конец-->

          </div>
        </div>

        <div class="col-md-4">
          <div class="card">
            <h5>Имя пользователя: <input name="username" value="<%=user.get('username')%>" type="text" class="form-control-personalArea" id="input-username"  ></h5>
            <h5>Изменить пароль: <input name="password" value="" type="text" class="form-control-personalArea" id="input-password" placeholder="Введите новый пароль"></h5>
            <h5>Ваш email: <input name="email" value="<%=user.get('email')%>" type="text" class="form-control-personalArea" id="input-email"></h5>
            <h5>Ваш пол:
              <SELECT name="gender" type="text" class="form-control-personalArea" id="input-gender" >
                <% switch (user.gender) {
                case "Мужской": %>
                  <OPTION><%=user.get('gender')%></OPTION>
                  <OPTION>Женский</OPTION>
                  <OPTION>Не определен</OPTION>
                   <% break; %><%
                  case "Женский": %>
                    <OPTION><%=user.get('gender')%></OPTION>
                    <OPTION>Мужской</OPTION>
                    <OPTION>Не определен</OPTION>
                     <% break; %> <%
                  case "Не определен": %>
                        <OPTION><%=user.get('gender')%></OPTION>
                        <OPTION>Мужской</OPTION>
                        <OPTION>Женский</OPTION>
                       <% break; %>  <% } %>
              </SELECT>
            </h5>
            <h5>О себе: <input name="aboutMySelf" value="<%=user.get('aboutMySelf')%>" type="text" class="form-control-personalArea-aboutMe" id="input-aboutMe" placeholder="Расскажите о себе"></h5>
            <button type="submit" class="btn btn-primary" id="updatePesonalData">Обновить информацию</button>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card">
            <h5>Номер счета: <%=user.get('numberInvoice')%></h5>
            <h5>Ваш баланс: <%=user.get('balanceInvoice')%> VM</h5>
            <h5><a href="#"><u>ПОПОЛНИТЬ СЧЕТ</u></a></h5>
            <h5><a href="#"><u>Желаете получать доход от ваших товаров?</u></a></h5>
            <h5>Дата регистрации: <%=user.get('created')%></h5>
            <h5>Как выглядит ваш публичный профиль: <a href="/publicProfile",><%=user.get('username')%></a></h5>
            <h5>Список пользователей: <a href="/#">СПИСОК</a></h5>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
  <br><br><br>
  <h3 align="center"><strong>Ваши покупки</strong></h3>

  <br>
  <h3 align="center"><strong>Ваши работы</strong></h3>
</div>
  <!-- БЛОК с частями об аккаунте КОНЕЦ-->

  <script>
// Клиентский код //
// Человек вводит логин, email,
$(document.forms['cabinet_form']).on('submit', function() {
  var form = $(this);

  $('.error', form).html('');
  $(":submit", form).button("loading");

  // Этот логин, email, пароль отправляются на сервер
  $.ajax({
    url: "/updatePersonalData", // роут: require('./registration').post
    method: "POST",
    data: form.serialize(),
    complete: function() {
      $(":submit", form).button("reset");
    },
    statusCode: {
      // если ответ сервера 200 - перенаправляем человека в личный кабинет(успешно создали нового пользователя)
      200: function() {

        form.html("Вы успешно обновились").addClass('alert-success');
        window.location.href = "/personalArea";
      },
      // если 403 - высвечивается ошибка(уже есть такой пользователь)
      403: function(jqXHR) {
        var error = JSON.parse(jqXHR.responseText);
        $('.error', form).html(error.message);
      }
    }
  });
  return false;
});
</script>


<script>
// Пока не получается применить такой способ, если в ejs пихаем
$("#myAvatar").click(function(){
  var choiseAvatar = $("#myAvatar").val();

  switch (choiseAvatar) {
    case "1":
      $("#avatarAdmin_1").css("display","block");
      $("#avatarAdmin_2").css("display","none");
      $("#avatarAdmin_3").css("display","none");
      break;
    case "2":
    $("#avatarAdmin_1").css("display","none");
    $("#avatarAdmin_2").css("display","block");
    $("#avatarAdmin_3").css("display","none");
      break;
    case "3":
    $("#avatarAdmin_1").css("display","none");
    $("#avatarAdmin_2").css("display","none");
    $("#avatarAdmin_3").css("display","block");
      break;
  }

});


</script>
